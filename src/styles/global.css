/* Define our layers - order determines cascade priority */
@layer reset, base, typography, layout, utilities, longform, theme;

/* Imports */
@import './mermaid.css';

/* ============================================
   FONT FACES
   ============================================ */
@font-face {
  font-family: 'Literata';
  src: url('/fonts/Literata-self-compiled-Mar2019.woff2') format('woff2');
  font-style: normal;
  font-display: swap;
}

@font-face {
  font-family: 'Literata';
  src: url('/fonts/Literata-Italic-self-compiled-Mar2019.woff2') format('woff2');
  font-style: italic;
  font-display: swap;
}

/* ============================================
   @PROPERTY DECLARATIONS
   ============================================ */
@property --color-accent {
  syntax: '<color>';
  inherits: true;
  initial-value: oklch(70% 0.18 25);
}

@property --surface-raised {
  syntax: '<color>';
  inherits: true;
  initial-value: #ffffff;
}

/* ============================================
   DESIGN TOKENS
   ============================================ */
:root {
  /* ======= COLOURS ======= */

  /* Core Hues - shared across modes */
  --hue-coral: 25;
  --hue-pink: 350;
  --hue-orange: 55;
  --hue-purple: 300;
  --hue-yellow: 95;
  --hue-green: 165;
  --hue-blue: 250;
  --hue-grey: 210;

  /* Absolute colors - no mode switching needed */
  --color-white: oklch(100% 0 0);
  --color-black: oklch(0% 0 0);

  /* Adaptive Color Palette
    Each color auto-adapts for light/dark mode.
    Dark mode: increase lightness for visibility, reduce chroma to avoid harshness */

  --color-coral: light-dark(oklch(70% 0.18 var(--hue-coral)), oklch(80% 0.14 var(--hue-coral)));

  --color-pink: light-dark(oklch(55% 0.15 var(--hue-pink)), oklch(70% 0.13 var(--hue-pink)));

  --color-orange: light-dark(oklch(78% 0.16 var(--hue-orange)), oklch(80% 0.14 var(--hue-orange)));

  --color-purple: light-dark(oklch(60% 0.14 var(--hue-purple)), oklch(72% 0.12 var(--hue-purple)));

  --color-yellow: light-dark(oklch(90% 0.16 var(--hue-yellow)), oklch(82% 0.12 var(--hue-yellow)));

  --color-green: light-dark(oklch(65% 0.12 var(--hue-green)), oklch(72% 0.1 var(--hue-green)));

  --color-blue: light-dark(oklch(62% 0.15 var(--hue-blue)), oklch(70% 0.13 var(--hue-blue)));

  /* Neutrals - structural colors for backgrounds/text */
  --color-ink: oklch(28% 0.01 var(--hue-grey));
  --color-charcoal: oklch(24.35% 0 0); /* #202020 */
  --color-beige: oklch(96% 0.02 85);

  /* ======= SEMANTIC COLOURS ======= */
  /* Role-based tokens that reference the adaptive palette */

  --color-accent: var(--color-coral);
  --color-visited: var(--color-purple);
  --color-highlight: var(--color-yellow);

  --color-background: light-dark(var(--color-beige), var(--color-charcoal));
  --color-background-secondary: light-dark(
    oklch(from var(--color-beige) calc(l + 0.02) c h),
    oklch(from var(--color-charcoal) calc(l - 0.04) c h)
  );
  --color-text: light-dark(var(--color-ink), var(--color-beige));
  --color-text-secondary: light-dark(
    oklch(55% 0.01 var(--hue-grey)),
    oklch(75% 0.01 var(--hue-grey))
  );
  --color-border: light-dark(
    oklch(from var(--color-black) l c h / 0.1),
    oklch(from var(--color-white) l c h / 0.1)
  );

  /* Surface for raised cards/panels - white in light mode, dark grey in dark mode */
  --surface-raised: light-dark(var(--color-white), oklch(16% 0 0));

  /* ======= FONTS ======= */

  --font-ui: 'League Spartan Variable', 'Inter', 'Helvetica Neue', Helvetica, Arial, sans-serif;
  --font-prose: 'Literata', Georgia, 'Times New Roman', serif;
  --font-code: 'Fira Code Variable', 'Fira Code', 'Inconsolata', monospace;

  /* ======= SPACING ======= */
  /* @link https://utopia.fyi/space/calculator?c=375,16,1.2,1280,20,1.333,5,2,&s=0.75|0.5|0.25,1.5|2|3|4|6,s-l&g=s,l,xl,12 */

  --space-3xs: clamp(0.25rem, 0.2241rem + 0.1105vw, 0.3125rem);
  --space-2xs: clamp(0.5rem, 0.4482rem + 0.221vw, 0.625rem);
  --space-xs: clamp(0.75rem, 0.6723rem + 0.3315vw, 0.9375rem);
  --space-s: clamp(1rem, 0.8964rem + 0.442vw, 1.25rem);
  --space-m: clamp(1.5rem, 1.3446rem + 0.663vw, 1.875rem);
  --space-l: clamp(2rem, 1.7928rem + 0.884vw, 2.5rem);
  --space-xl: clamp(3rem, 2.6892rem + 1.326vw, 3.75rem);
  --space-2xl: clamp(4rem, 3.5856rem + 1.768vw, 5rem);
  --space-3xl: clamp(6rem, 5.3785rem + 2.6519vw, 7.5rem);

  /* One-up pairs */
  --space-3xs-2xs: clamp(0.25rem, 0.0946rem + 0.663vw, 0.625rem);
  --space-2xs-xs: clamp(0.5rem, 0.3187rem + 0.7735vw, 0.9375rem);
  --space-xs-s: clamp(0.75rem, 0.5428rem + 0.884vw, 1.25rem);
  --space-s-m: clamp(1rem, 0.6374rem + 1.547vw, 1.875rem);
  --space-m-l: clamp(1.5rem, 1.0856rem + 1.768vw, 2.5rem);
  --space-l-xl: clamp(2rem, 1.2749rem + 3.0939vw, 3.75rem);
  --space-xl-2xl: clamp(3rem, 2.1713rem + 3.5359vw, 5rem);
  --space-2xl-3xl: clamp(4rem, 2.5497rem + 6.1878vw, 7.5rem);

  /* ======= TYPOGRAPHY ======= */
  /* @link https://utopia.fyi/type/calculator?c=375,16,1.2,1280,20,1.333,5,2,&s=0.75|0.5|0.25,1.5|2|3|4|6,s-l&g=s,l,xl,12 */

  --step--2: clamp(0.6944rem, 0.6907rem + 0.016vw, 0.7035rem);
  --step--1: clamp(0.8333rem, 0.7901rem + 0.1846vw, 0.9377rem);
  --step-0: clamp(1rem, 0.8964rem + 0.442vw, 1.25rem);
  --step-1: clamp(1.2rem, 1.0068rem + 0.8243vw, 1.6663rem);
  --step-2: clamp(1.44rem, 1.1163rem + 1.381vw, 2.2211rem);
  --step-3: clamp(1.728rem, 1.2172rem + 2.1794vw, 2.9607rem);
  --step-4: clamp(2.0736rem, 1.2975rem + 3.3115vw, 3.9467rem);
  --step-5: clamp(2.4883rem, 1.3395rem + 4.9018vw, 5.2609rem);

  /* Semantic aliases */
  --font-size-xs: var(--step--2);
  --font-size-sm: var(--step--1);
  --font-size-base: var(--step-0);
  --font-size-md: var(--step-1);
  --font-size-lg: var(--step-2);
  --font-size-xl: var(--step-3);
  --font-size-2xl: var(--step-4);
  --font-size-3xl: var(--step-5);

  /* Line Heights */
  --leading-none: 0.9;
  --leading-tight: 1.1;
  --leading-snug: 1.2;
  --leading-normal: 1.5;
  --leading-loose: 1.7;

  /* Letter Spacing */
  --tracking-tight: -0.02ch;
  --tracking-normal: 0;
  --tracking-wide: 0.05ch;
  --tracking-wider: 0.1ch;

  /* Measure - standard line length for readability */
  --measure-standard: 80ch;

  /* Font Weights */
  --font-weight-light: 300;
  --font-weight-normal: 350;
  --font-weight-regular: 400;
  --font-weight-medium: 500;
  --font-weight-semibold: 600;
  --font-weight-bold: 700;

  /* ----- BORDERS ----- */
  --border-width-hairline: 1px;
  --border-width-base: 2px;
  --border-width-thick: 4px;
  --border-width-heavy: 6px;
  --border-width-accent: 1rem;

  --radius-xs: 0.125rem;
  --radius-sm: 0.25rem;
  --radius-md: 0.5rem;
  --radius-lg: 0.75rem;
  --radius-full: 9999px;

  /* ----- MOTION ----- */
  --duration-fast: 150ms;
  --duration-normal: 200ms;
  --duration-slow: 300ms;

  --ease-in-out: cubic-bezier(0.4, 0, 0.2, 1);

  /* ----- SHADOWS ----- */
  --shadow-small: drop-shadow(0px 1px 3px rgba(16, 24, 40, 0.1))
    drop-shadow(0px 1px 2px rgba(16, 24, 40, 0.1));
  --shadow-medium: drop-shadow(0px 1px 3px rgba(16, 24, 40, 0.1))
    drop-shadow(0px 4px 6px rgba(16, 24, 40, 0.1));
}

/* ============================================
    RESET LAYER
    Uses :where() for zero specificity
   ============================================ */
@layer reset {
  /* Use a more-intuitive box-sizing model with :where() for zero specificity */
  :where(*, *::before, *::after) {
    box-sizing: border-box;
  }

  /* Remove default margin */
  :where(*) {
    margin-block: 0;
  }

  /* Better focus outline spacing */
  :where(:focus-visible) {
    outline-offset: 3px;
  }

  /* Enable keyword animations (animate to/from 'auto') */
  @media (prefers-reduced-motion: no-preference) {
    :where(html) {
      interpolate-size: allow-keywords;
    }
  }

  :where(html) {
    /* Prevent font size inflation on mobile */
    -moz-text-size-adjust: none;
    -webkit-text-size-adjust: none;
    text-size-adjust: none;

    /* Prevent layout shift when scrollbars appear */
    scrollbar-gutter: stable;
  }

  :where(body) {
    /* Add accessible line-height */
    line-height: 1.5;

    /* Improve text rendering */
    -webkit-font-smoothing: antialiased;

    /* Sensible min-height */
    min-height: 100vh;

    /* Position relative for absolutely positioned children */
    position: relative;

    /* Remove default padding and margin */
    padding: 0;
    margin: 0;
  }

  /* Improve media defaults */
  :where(img, picture, video, canvas, svg) {
    display: block;
    max-width: 100%;
  }

  :where(img, picture) {
    height: auto;
  }

  /* Remove default img border */
  :where(img) {
    border: 0;
  }

  /* Inherit fonts for form controls */
  :where(input, button, textarea, select) {
    font: inherit;
  }

  /* Set shorter line heights on interactive elements */
  :where(button, input, label) {
    line-height: 1.1;
  }

  /* Auto-growing textarea */
  :where(textarea) {
    field-sizing: content;
  }

  /* Fix fieldset sizing in flexbox/grid */
  :where(fieldset) {
    min-inline-size: 0;
  }

  /* Normalize search input appearance */
  :where([type='search']) {
    -webkit-appearance: textfield;
    appearance: textfield;
  }

  /* Keep specific input types LTR in RTL layouts */
  :where(
    input:is([type='tel'], [type='url'], [type='email'], [type='number']):not(:placeholder-shown)
  ) {
    direction: ltr;
  }

  /* Sensible defaults for iframes */
  :where(iframe) {
    border: 0;
    overflow: hidden;
  }

  /* Avoid text overflows */
  :where(p, h1, h2, h3, h4, h5, h6) {
    overflow-wrap: break-word;
  }

  /* Improve line wrapping */
  :where(h1, h2, h3, h4, h5, h6) {
    text-wrap: balance;
  }

  /* Prevent widows and orphans in body text */
  :where(p, blockquote) {
    text-wrap: pretty;
  }

  /* Anything that has been anchored to should have extra scroll margin */
  :where(:target) {
    scroll-margin-block: 5ex;
  }

  /* Sensible wrapping for code blocks */
  :where(pre) {
    white-space: pre-wrap;
  }

  /* Strengthen hidden attribute */
  :where([hidden]:not([hidden='until-found'])) {
    display: none !important;
  }

  /* Remove list styles on ul, ol elements with a list role */
  :where(ul[role='list'], ol[role='list']) {
    list-style: none;
  }

  /* Abbreviations */
  :where(abbr) {
    font-variant: all-small-caps;
    text-decoration: underline;
    text-decoration-style: dashed;
    text-decoration-color: color-mix(in srgb, currentColor, transparent 50%);
    text-decoration-thickness: max(0.08em, 1px);
    text-underline-offset: 0.2em;
    text-decoration-skip-ink: none;
  }

  :where(abbr[title]) {
    cursor: help;
  }

  /* Superscript and subscript */
  :where(sup, sub) {
    font-size: 0.7em;
    line-height: 1;
  }

  /* Strikethrough */
  :where(del) {
    text-decoration: line-through;
    text-decoration-color: color-mix(in srgb, currentColor, transparent 50%);
    text-decoration-thickness: 1px;
    text-underline-offset: 0.2em;
  }

  /* High contrast mode support for mark */
  @media (forced-colors: active) {
    :where(mark) {
      color: HighlightText;
      background-color: Highlight;
    }
  }

  /* Smooth scrolling for user-initiated navigation */
  @media (prefers-reduced-motion: no-preference) {
    html:focus-within {
      scroll-behavior: smooth;
    }
  }

  /* Reduced motion support */
  @media (prefers-reduced-motion: reduce) {
    * {
      animation-duration: 0.01ms !important;
      animation-iteration-count: 1 !important;
      transition-duration: 0.01ms !important;
      scroll-behavior: auto !important;
    }
  }
}

/* ============================================
   BASE LAYER
   ============================================ */
@layer base {
  html {
    /* Colors - support both light/dark */
    color-scheme: light dark;
    accent-color: var(--color-accent);
    color: var(--color-text);

    /* Smooth Scrolling */
    scroll-behavior: smooth;
  }

  body {
    /* Background color - global default so pages don't need to set it */
    background-color: var(--color-background);
  }

  /* Highlight */
  mark {
    background-color: var(--color-highlight);
    border-radius: 0.05em;
  }

  /* Simple, attractive global table styles */
  table {
    border-collapse: collapse;
    width: 100%;
    margin: 2em 0;
    font-size: 1em;
    background-color: var(--color-background-secondary);
    caption-side: bottom;
  }

  th,
  td {
    border: 1px solid var(--color-border);
    padding: 0.2em 0.5em;
    text-align: left;
    vertical-align: baseline;
  }

  th {
    font-weight: 600;
    text-transform: uppercase;
    background-color: var(--color-background-secondary);
    border-bottom-width: 2px;
  }

  /* Better cursor for summary */
  summary {
    cursor: default;
  }

  /* Button default */
  button,
  input[type='button'],
  input[type='submit'],
  input[type='reset'] {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 0.5cap;
    font-family: var(--font-ui);
    font-weight: var(--font-weight-medium);
    line-height: 1;
    cursor: pointer;
    border: var(--border-width-hairline) solid var(--color-border);
    border-radius: var(--radius-sm);
    padding: 0.4em 0.75em;
    background-color: var(--color-background-secondary);
    color: inherit;
    text-box: trim-both cap alphabetic;
    svg {
      width: 1.25cap;
      height: 1.25cap;
      flex-shrink: 0;
    }
  }
}

/* ============================================
   TYPOGRAPHY LAYER
   ============================================ */
@layer typography {
  html {
    /* Font variant ligatures */
    font-variant-ligatures: common-ligatures;

    /* Hanging punctuation */
    hanging-punctuation: first allow-end last;
  }

  body {
    /* Defaults for font family, size, weight and line height */
    font-family: var(--font-prose);
    font-size: var(--font-size-base);
    font-weight: var(--font-weight-normal);
    line-height: var(--leading-normal);
  }

  /* Headings - scaled for article content, semibold weight */
  h1,
  h2,
  h3,
  h4,
  h5,
  h6 {
    font-weight: var(--font-weight-semibold);
    line-height: var(--leading-snug);
    margin-top: 1.5em;
    border-bottom: var(--border-width-hairline) solid var(--color-border);
    padding-bottom: 0.3em;
  }

  h1 {
    font-size: var(--font-size-xl);
  }

  h2 {
    font-size: var(--font-size-lg);
  }

  h3 {
    font-size: var(--font-size-md);
  }

  h4,
  h5,
  h6 {
    font-size: var(--font-size-base);
  }

  /* Links - nice underlines for prose */
  a {
    color: var(--color-accent);
    text-decoration: underline;
    text-decoration-thickness: max(0.08em, 1px);
    text-underline-offset: 0.2em;
    text-decoration-skip-ink: auto;
    transition:
      color var(--duration-fast) var(--ease-in-out),
      text-decoration-color var(--duration-fast) var(--ease-in-out);
  }

  a:visited {
    color: var(--color-visited);
  }

  a:hover,
  a:focus {
    color: var(--color-accent);
  }

  /* Subtle underlines when not interacting */
  a:not(:is(:hover, :focus)) {
    text-decoration-color: color-mix(in srgb, currentColor, transparent 60%);
  }

  /* Lists with colored markers */
  ul,
  ol {
    padding-left: var(--space-m);
  }

  li {
    padding-left: var(--space-xs);
    margin-top: var(--space-xs);
  }

  li:first-child {
    margin-top: 0;
  }

  /* Nested lists need space from parent li content */
  li > ul,
  li > ol {
    margin-top: var(--space-xs);
  }

  li::marker {
    color: var(--color-accent);
  }

  ul {
    list-style-type: 'â€¢';
  }

  /* Blockquotes */
  blockquote {
    border-left: var(--border-width-thick) solid var(--color-accent);
    padding-left: var(--space-m);
    font-style: italic;
    margin-left: 0;
  }

  /* Blockquote citations - figcaption within blockquote */
  blockquote figcaption {
    margin-top: var(--space-2xs);
    text-align: right;
    padding-left: var(--space-m);
  }

  /* Citation element - counteract italic from blockquote */
  blockquote cite {
    font-family: var(--font-ui);
    font-size: var(--font-size-sm);
    font-style: normal;
    color: var(--color-text-secondary);
  }

  /* Prose spacing rhythm */
  :where(p, ul, ol, blockquote, pre, figure, table) {
    margin-top: 1.25em;
  }

  /* Remove top margin from first children */
  :where(p, ul, ol, blockquote, pre, figure, table):first-child {
    margin-top: 0;
  }

  /* Inline code */
  :not(pre) > code {
    font-family: var(--font-code);
    font-size: var(--font-size-sm);
    font-variant-numeric: normal; /* Reset diagonal-fractions from prose */
    background-color: var(--color-background-secondary);
    border: var(--border-width-hairline) solid var(--color-border);
    padding: 0.1em 0.4em;
    border-radius: var(--radius-sm);
  }

  /* Strong text */
  strong {
    font-weight: var(--font-weight-bold);
  }

  /* Keyboard input - styled like physical keys */
  kbd {
    font-family: var(--font-ui);
    font-size: 0.875em;
    font-weight: var(--font-weight-medium);
    font-variant-numeric: normal; /* Reset diagonal-fractions from prose */
    padding: 0.1em 0.4em;
    background-color: var(--color-background-secondary);
    border: var(--border-width-hairline) solid var(--color-border);
    border-radius: var(--radius-sm);
    box-shadow: inset 0 -1px 0 var(--color-border);
    white-space: nowrap;
  }
}

/* ============================================
   LAYOUT LAYER - Reusable layout patterns
   ============================================ */
@layer layout {
  /* Flow utility - consistent vertical spacing */
  .flow > * + * {
    margin-top: var(--space-m);
  }

  /* Headings get larger, proportionate top margins for clear section breaks */
  .flow > * + :is(h1, h2) {
    margin-top: var(--space-xl);
  }

  .flow > * + h3 {
    margin-top: var(--space-l);
  }

  /* List reset - for navigation and UI lists */
  .list-reset {
    list-style: none;
    margin: 0;
    padding: 0;
    gap: var(--space-xs);
  }

  /* All caps utility - for labels and UI text */
  .all-caps {
    text-transform: uppercase;
    letter-spacing: var(--tracking-wide);
  }
}

/* ============================================
   UTILITIES LAYER - Single-purpose helpers
   ============================================ */
@layer utilities {
  /* ----------------------------------------
     .ui-style - Opt-out of prose typography
     Apply to navigation, footers, page titles, and UI-heavy areas
     ---------------------------------------- */
  .ui-style {
    /* Switch to UI font */
    font-family: var(--font-ui);
    font-weight: var(--font-weight-normal);
    line-height: var(--leading-snug);

    /* Remove prose link styling */
    & a {
      text-decoration: none;
      color: inherit;
      transition: color var(--duration-fast) ease-in-out;
    }

    & a:visited {
      color: inherit;
    }

    & a:hover,
    & a:focus {
      color: var(--color-accent);
    }

    /* Remove heading borders and adjust spacing */
    & :is(h1, h2, h3, h4, h5, h6) {
      border-bottom: none;
      padding-bottom: 0;
      margin-top: 0;
    }

    /* Remove list marker colors */
    & li::marker {
      color: inherit;
    }

    /* Tighter prose spacing */
    & :where(p, ul, ol, blockquote) {
      margin-top: var(--space-m);
    }
  }

  /* ----------------------------------------
     .dark-surface - Always-dark areas (nav, footer etc)
     Combine with .ui-style for dark UI areas
     ---------------------------------------- */
  .dark-surface {
    background-color: var(--color-charcoal);
    color: var(--color-beige);
  }

  /* Container query utility */
  .cq {
    container-type: inline-size;
  }

  /* ----------------------------------------
     Card/panel surface styling
     Apply to raised cards, panels, callouts etc
     ---------------------------------------- */
  .card-surface {
    background-color: var(--surface-raised);
    border: var(--border-width-hairline) solid var(--color-border);
    border-radius: var(--radius-sm);
    filter: var(--shadow-small);
  }

  /* Image cover - for responsive images that fill their container */
  .img-cover {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  /* Content trim - removes top/bottom margins from first/last children
     Use inside containers with padding where slotted content has margins */
  .content-trim {
    & > :first-child {
      margin-top: 0;
    }
    & > :last-child {
      margin-bottom: 0;
    }
  }

  /* Hidden utility for screen readers and microformats */
  .sr-only,
  .hidden-microformat {
    position: absolute !important;
    width: 1px !important;
    height: 1px !important;
    padding: 0 !important;
    margin: -1px !important;
    overflow: hidden !important;
    clip: rect(0, 0, 0, 0) !important;
    white-space: nowrap !important;
    border: 0 !important;
  }
}
