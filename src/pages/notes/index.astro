---
import BaseHead from '@components/layout/BaseHead.astro';
import { getCollection, render } from 'astro:content';
import FormattedDate from '@components/ui/FormattedDate.astro';
import Footer from '@components/layout/Footer.astro';
import MainNavigation from '@components/layout/MainNavigation.astro';
import NoteCard from '@components/layout/NoteCard.astro';
import { MDX_COMPONENT_REMAPPING } from '@config/mdx-components';
import { filterContentForListing } from '@utils/content';
import MarkdownContentActions from '@components/ui/MarkdownContentActions.astro';

const notes = filterContentForListing(await getCollection('notes')).sort(
  (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
);

// Split notes into recent (first 2) and archive (rest)
const numberOfRecentNotes = 5;
const recentNotes = notes.slice(0, numberOfRecentNotes);
const olderNotes = notes.slice(numberOfRecentNotes);

// Render the recent notes content
const recentNotesWithContent = await Promise.all(
  recentNotes.map(async note => {
    const { Content } = await render(note);
    return { note, Content };
  })
);
---

<!doctype html>
<html lang="en">
  <head>
    <BaseHead
      title="Notes"
      description="Short-form thoughts and observations on remote work, technology, and business operations"
      pageType="page"
    />
  </head>
  <body>
    <MainNavigation />
    <main>
      <h1 class="title ui-style">Notes</h1>

      <!-- Recent Notes as Cards (prose styling for content) -->
      {
        recentNotesWithContent.length > 0 && (
          <section class="recent-notes" aria-label="Recent Notes">
            {recentNotesWithContent.map(({ note, Content }) => (
              <div class="note-container cq">
                <NoteCard
                  title={note.data.title}
                  pubDate={note.data.pubDate}
                  sourceURL={note.data.sourceURL}
                  tags={note.data.tags}
                  slug={note.id}
                >
                  <Content components={MDX_COMPONENT_REMAPPING} />
                  <MarkdownContentActions markdownUrl={`/notes/${note.id}.md`} disableShare={true} />
                </NoteCard>
              </div>
            ))}
          </section>
        )
      }

      <!-- Archive List (UI styling) -->
      {
        olderNotes.length > 0 && (
          <section class="archive-section ui-style" aria-label="Archive">
            <div class="archive-content">
              <h2 class="archive-title">Older Notes</h2>
              <ul class="archive-list list-reset">
                {olderNotes.map(note => (
                  <li>
                    <a href={`/notes/${note.id}/`}>
                      <p class="date all-caps">
                        <FormattedDate date={note.data.pubDate} />
                      </p>
                      <h4 class="note-title">{note.data.title}</h4>
                    </a>
                  </li>
                ))}
              </ul>
            </div>
          </section>
        )
      }
    </main>
    <Footer />
<style>
      body {
        display: grid;
        grid-template-rows: auto min-content;
      }

      .title {
        font-size: clamp(3rem, 14vw, 20rem);
        font-weight: var(--font-weight-bold);
        text-transform: uppercase;
        text-align: right;
        line-height: var(--leading-none);
        transform: translateY(-0.1em);
        pointer-events: none;
        margin: 0;
        border: 0;
      }

      .note-container {
        max-width: var(--measure-standard);
        width: 100%;
      }

      .archive-content {
        max-width: var(--measure-standard);
        width: 100%;
      }

      .recent-notes,
      .archive-section {
        padding: var(--space-s);
        display: grid;
        place-items: center;
      }

      .recent-notes {
        padding-top: var(--space-2xl);
        gap: var(--space-xl);
      }

      .archive-section {
        margin-top: var(--space-xl);
      }

      .archive-title {
        font-size: var(--font-size-2xl);
        font-weight: var(--font-weight-semibold);
        margin-bottom: var(--space-m);
        padding-bottom: var(--space-2xs);
        border-bottom: var(--border-width-base) solid var(--color-border);
      }

      .date {
        font-size: var(--font-size-xs);
        color: var(--color-text-secondary);
      }

      .note-title {
        font-size: var(--font-size-md);
        font-weight: var(--font-weight-semibold);
        line-height: var(--leading-tight);
        padding-bottom: var(--space-3xs);
        border-bottom: var(--border-width-thick) solid var(--color-accent);
        transition: color var(--duration-fast) var(--ease-in-out);

        a:hover & {
          color: var(--color-accent);
        }
      }

      @media (min-width: 800px) {
        .recent-notes,
        .archive-section {
          padding: var(--space-l);
        }

        .recent-notes {
          padding-top: var(--space-2xl);
        }

        .archive-list {
          display: grid;
          grid-template-columns: auto auto;
          justify-content: start;
          align-items: baseline;
          gap: var(--space-m) var(--space-s);

          & li,
          & a {
            display: contents;
          }
        }

        .date {
          text-align: right;
        }
      }
    </style>
  </body>
</html>
