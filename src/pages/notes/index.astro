---
import BaseHead from '@components/layout/BaseHead.astro';
import { getCollection, render } from 'astro:content';
import FormattedDate from '@components/ui/FormattedDate.astro';
import Footer from '@components/layout/Footer.astro';
import MainNavigation from '@components/layout/MainNavigation.astro';
import NoteCard from '@components/layout/NoteCard.astro';
import { MDX_COMPONENT_REMAPPING } from '@config/mdx-components';
import { filterContentForListing } from '@utils/content';

const notes = filterContentForListing(await getCollection('notes')).sort(
  (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
);

// Split notes into recent (first 2) and archive (rest)
const numberOfRecentNotes = 5;
const recentNotes = notes.slice(0, numberOfRecentNotes);
const olderNotes = notes.slice(numberOfRecentNotes);

// Render the recent notes content
const recentNotesWithContent = await Promise.all(
  recentNotes.map(async note => {
    const { Content } = await render(note);
    return { note, Content };
  })
);
---

<!doctype html>
<html lang="en">
  <head>
    <BaseHead
      title="Notes"
      description="Short-form thoughts and observations on remote work, technology, and business operations"
      pageType="page"
    />
  </head>
  <body>
    <MainNavigation />
    <main class="ui-style">
      <h1 class="title">Notes</h1>

      <!-- Recent Notes as Cards -->
      {
        recentNotesWithContent.length > 0 && (
          <section class="recent-notes" aria-label="Recent Notes">
            {recentNotesWithContent.map(({ note, Content }) => (
              <div class="note-container">
                <NoteCard
                  title={note.data.title}
                  pubDate={note.data.pubDate}
                  sourceURL={note.data.sourceURL}
                  tags={note.data.tags}
                  slug={note.id}
                >
                  <Content components={MDX_COMPONENT_REMAPPING} />
                </NoteCard>
              </div>
            ))}
          </section>
        )
      }

      <!-- Archive List -->
      {
        olderNotes.length > 0 && (
          <section class="archive-section" aria-label="Archive">
            <div class="archive-content">
              <h2 class="archive-title">Older Notes</h2>
              <ul class="archive-list">
                {olderNotes.map(note => (
                  <li>
                    <a href={`/notes/${note.id}/`}>
                      <p class="date">
                        <FormattedDate date={note.data.pubDate} />
                      </p>
                      <h4 class="note-title">{note.data.title}</h4>
                    </a>
                  </li>
                ))}
              </ul>
            </div>
          </section>
        )
      }
    </main>
    <Footer />
    <!-- DISABLED-STYLE <style>
      body {
        display: grid;
        grid-template-rows: auto min-content;
      }

      main {
        min-height: 100vh;
      }

      .title {
        text-transform: uppercase;
        font-size: clamp(3rem, 14vw, 20rem);
        transform: translateY(-0.3em);
        text-align: right;
        pointer-events: none;
        padding: 0 var(--space-4);
      }

      /* Shared content width constraint */
      .note-container,
      .archive-content {
        max-width: 80ch;
        width: 100%;
      }

      /* Shared section styles */
      .recent-notes,
      .archive-section {
        padding: var(--space-4);
        display: grid;
        place-items: center;
      }

      .recent-notes {
        padding-top: var(--space-16);
        gap: var(--space-12);
      }

      .archive-section {
        margin-top: var(--space-12);
      }

      .note-container {
        container-type: inline-size;
      }

      .archive-title {
        font-size: var(--font-size-2xl);
        font-weight: var(--font-weight-semibold);
        margin-bottom: var(--space-6);
        padding-bottom: var(--space-2);
        border-bottom: var(--border-width-base) solid var(--color-border);
        color: var(--color-text-primary);
      }

      .archive-list {
        list-style: none;
        margin: 0;
        padding: 0;
      }

      .archive-list li {
        margin-bottom: var(--space-8);
      }

      .archive-list a {
        display: block;
        width: 100%;
      }

      .archive-list a:hover .note-title {
        color: var(--color-accent);
      }

      .archive-list .date {
        font-size: var(--font-size-xs);
        color: var(--color-notelist-date);
        text-transform: uppercase;
        letter-spacing: var(--tracking-wider);
      }

      .archive-list .note-title {
        font-size: var(--font-size-md);
        line-height: var(--leading-tight);
        font-weight: var(--font-weight-medium);
        padding-bottom: var(--space-1);
        border-bottom: var(--border-width-thick) var(--color-notelist-border) solid;
        transition: all var(--duration-fast) var(--ease-default);
      }

      @media screen and (min-width: 800px) {
        .recent-notes,
        .archive-section {
          padding: var(--space-8);
        }

        .recent-notes {
          padding-top: var(--space-16);
        }

        .archive-list a {
          display: grid;
          gap: var(--space-4);
          grid-template-columns: 120px 1fr;
          align-items: end;
        }

        .archive-list .date {
          text-align: right;
          padding-bottom: calc(var(--space-1) + var(--border-width-thick));
        }
      }
    </style> -->
  </body>
</html>
