---
/**
 * StyleguideTOC - Simple sticky table of contents for the styleguide
 * Provides anchor links to major sections
 */

export interface Props {
  sections: Array<{ id: string; label: string }>;
}

const { sections } = Astro.props;
---

<nav class="styleguide-toc ui-style" aria-label="Styleguide navigation">
  <ul class="toc-list list-reset">
    {
      sections.map(({ id, label }) => (
        <li>
          <a href={`#${id}`} class="toc-link">
            {label}
          </a>
        </li>
      ))
    }
  </ul>
</nav>

<script>
  // Simple scroll spy to highlight current section
  const tocLinks = document.querySelectorAll('.styleguide-toc .toc-link');
  const sections = document.querySelectorAll('.styleguide-section');

  function updateActiveLink() {
    const scrollPosition = window.scrollY + 100; // Offset for better UX

    sections.forEach((section) => {
      const sectionTop = (section as HTMLElement).offsetTop;
      const sectionHeight = (section as HTMLElement).offsetHeight;
      const sectionId = section.getAttribute('id');

      if (scrollPosition >= sectionTop && scrollPosition < sectionTop + sectionHeight) {
        tocLinks.forEach((link) => {
          link.classList.remove('is-active');
          if (link.getAttribute('href') === `#${sectionId}`) {
            link.classList.add('is-active');
          }
        });
      }
    });
  }

  // Throttle scroll events
  let ticking = false;
  window.addEventListener('scroll', () => {
    if (!ticking) {
      requestAnimationFrame(() => {
        updateActiveLink();
        ticking = false;
      });
      ticking = true;
    }
  });

  // Initial check
  updateActiveLink();
</script>

<style>
  .styleguide-toc {
    position: sticky;
    top: var(--space-m);
    align-self: start;
    padding: var(--space-s);
    background-color: var(--color-background-secondary);
    border-radius: var(--radius-sm);
    min-width: 10rem;
  }

  @media (max-width: 768px) {
    .styleguide-toc {
      position: static;
      margin-bottom: var(--space-m);
    }
  }

  .toc-list {
    display: flex;
    flex-direction: column;
    gap: var(--space-3xs);
    margin: 0;
  }

  .toc-link {
    display: block;
    padding: var(--space-3xs) var(--space-2xs);
    font-size: var(--font-size-sm);
    color: var(--color-text);
    border-radius: var(--radius-xs);
    transition:
      background-color var(--duration-fast) var(--ease-in-out),
      color var(--duration-fast) var(--ease-in-out);
  }

  .toc-link:hover {
    background-color: var(--color-background);
    color: var(--color-accent);
  }

  .toc-link.is-active {
    background-color: var(--color-accent);
    color: var(--color-white);
  }
</style>
