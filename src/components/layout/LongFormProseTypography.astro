---
export interface Props {
  class?: string;
  [key: string]: any;
}

const { class: className, ...props } = Astro.props;
---

<div class={`longform-prose cq ${className || ''}`} {...props}>
  <slot />
</div>

<style is:global>
  @layer longform {
    .longform-prose {
      --line-height: var(--line-height-article);

      font-weight: var(--font-weight-article);
      line-height: var(--line-height);
      text-rendering: optimizeLegibility;
    }

    .longform-prose:last-child {
      margin-bottom: 5em;
    }

    /* Headings */

    .longform-prose > :is(h1, h2, h3, h4, h5, h6) {
      /* font-variant-ligatures and hanging-punctuation now in base layer */
      border-bottom: var(--border-width-hairline) solid var(--color-border);
      padding-bottom: 0.6em;
    }

    .longform-prose h1.title {
      font-size: var(--font-size-2xl);
      font-weight: var(--font-weight-medium);
      font-variation-settings: 'opsz' 50;
      line-height: var(--leading-snug);
      margin-top: var(--space-8);
    }

    .longform-prose > h1 {
      font-size: var(--font-size-xl);
      font-weight: var(--font-weight-semibold);
      margin-top: 1.5em;
    }

    .longform-prose > h2 {
      font-size: var(--font-size-lg);
      font-weight: var(--font-weight-semibold);
      margin-top: 1.7em;
      margin-bottom: -0.5em;
    }

    .longform-prose > h3 {
      font-size: var(--font-size-md);
      font-weight: var(--font-weight-semibold);
      margin-top: 1.5em;
      margin-bottom: -0.5em;
    }

    .longform-prose > :is(h4, h5, h6) {
      font-size: var(--font-size-base);
      font-weight: var(--font-weight-normal);
      font-style: italic;
      margin-top: 1.5em;
      margin-bottom: -1em;
    }

    /* Remove top margin from headings that are immediatly preceeded by another heading or an HR */
    .longform-prose > :is(h1, h2, h3, h4, h5, h6, hr) + :is(h1, h2, h3, h4, h5, h6) {
      margin-top: 0;
    }

    /* ----------- Paragraphs ----------- */

    .longform-prose > p:first-of-type {
      margin-top: 3em;
    }

    .longform-prose > p {
      font-variant-numeric: oldstyle-nums diagonal-fractions;
      /* hanging-punctuation now in base layer */
    }

    /* Use hyphens only on small viewports. */
    @media (max-width: 42em) {
      .longform-prose > p {
        -webkit-hyphens: auto;
        hyphens: auto;
      }
    }

    /* End Mark */
    .longform-prose > p:last-of-type:after {
      color: var(--color-article-accent);
      display: inline-block;
      content: ' ';
      -webkit-mask: url('/end-mark.svg');
      mask: url('/end-mark.svg');
      -webkit-mask-size: cover;
      mask-size: cover;
      background-color: currentColor;
      height: 0.65em;
      width: 1em;
      line-height: 0.5;
      margin-left: 0.1em;
    }

    /* ----------- Links ----------- */

    .longform-prose a {
      color: inherit;
      text-decoration: underline;
      text-decoration-color: var(--color-article-accent);
      text-decoration-thickness: var(--border-width-hairline);
      text-underline-offset: 0.3em;
      text-decoration-skip-ink: none;
      border-radius: var(--radius-xs);
      transition: color var(--duration-fast) var(--ease-default),
                  text-decoration-color var(--duration-fast) var(--ease-default);
    }

    .longform-prose a:visited {
      text-decoration-color: var(--color-link-visited);
    }

    .longform-prose a:hover,
    .longform-prose a:active {
      text-decoration-color: var(--color-article-accent);
      color: var(--color-article-accent);
    }

    .longform-prose a:focus-visible {
      outline: var(--border-width-base) solid var(--color-article-accent);
      text-decoration: none;
    }

    @media (pointer: coarse) {
      .longform-prose a {
        text-decoration: none;
        color: var(--color-link-hover);
      }

      .longform-prose a:visited {
        color: var(--color-link-visited);
      }
    }

    .longform-prose h1 a {
      text-decoration: none;
      color: inherit;
    }

    /* ----------- Lists ----------- */

    .longform-prose li {
      padding-left: var(--space-4);
      margin-top: var(--space-2);
      /* Ensure marker color for all lists */
      &::marker {
        color: var(--color-article-accent);
      }
    }
    .longform-prose li:first-of-type {
      margin-top: 0;
    }

    .longform-prose :is(ul, ol) {
      font-variant-numeric: oldstyle-nums diagonal-fractions;
    }

    .longform-prose ul {
      padding-left: 0.4em;
      list-style-type: 'โข';
    }

    .longform-prose ol {
      padding-left: 0.4em;
      list-style-type: decimal;
    }

    .longform-prose ol ::marker {
      font-size: 1.4ex;
      font-variation-settings: 'opsz' 10;
      font-weight: var(--font-weight-medium);
      color: var(--color-article-accent);
    }

    /* ----------- Task Lists ------------ */

    .longform-prose .contains-task-list {
      list-style-type: none;
      padding-left: 0;
    }

    .longform-prose .task-list-item {
      padding-left: 0;
    }

    .longform-prose .task-list-item input {
      position: relative;
      height: 0.7em;
      width: 0.7em;
      margin-bottom: 0;
      appearance: none;
      outline: none;
      border-radius: var(--radius-xs);
      border: var(--border-width-hairline) solid var(--color-article-tasklist-border);
    }

    .longform-prose .task-list-item input:checked {
      color: var(--color-article-accent);
      background: transparent;
      border-color: var(--color-article-accent);
    }

    .longform-prose .task-list-item input:checked:before {
      content: '\2713';
      position: absolute;
      top: -0.1em;
      left: 0.05em;
      font-size: var(--font-size-xs);
      font-weight: var(--font-weight-semibold);
      color: var(--color-article-accent);
    }

    .longform-prose .task-list-item input[disabled] {
      opacity: 1;
    }

    /* ----------- Text Styles ----------- */

    .longform-prose strong {
      font-weight: var(--font-weight-semibold);
    }

    /* ----------- HR ----------- */
    .longform-prose hr {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 100%;
      height: 0;
      overflow: visible;
      margin: var(--space-12) 0;

      border: var(--border-width-hairline) solid var(--color-article-horizontal-rule);
    }

    .longform-prose hr:before {
      content: 'ยง';
      transform: translateY(-0.15em);
      background: var(--color-article-bg);
      padding: 0 var(--space-2);
    }

    /* ----------- Blockquotes ----------- */
    .longform-prose blockquote {
      font-variant-numeric: oldstyle-nums diagonal-fractions;
      /* hanging-punctuation now in base layer */
      border-left: var(--border-width-base) solid var(--color-article-accent);
      padding-left: calc((1em * var(--line-height)) - 2px); /* 2px matches --border-width-base */
      font-style: italic;
      margin-left: 0;
    }

    /* ----------- Footnotes ----------- */

    .longform-prose [data-footnote-ref] {
      display: inline-block;
      padding-inline: 0.5ch;
      font-size: var(--font-size-xs);
      font-weight: var(--font-weight-semibold);
      font-variant: small-caps;
      letter-spacing: var(--tracking-wide);
      text-decoration: none;
      color: var(--color-article-accent);
    }

    .inline-footnote-container {
      font-size: var(--font-size-sm);
      padding: var(--space-4);
      border-left: var(--border-width-base) solid var(--color-article-accent);
      background: var(--color-article-inline-footnote-bg);

      .data-footnote-backref {
        display: none;
      }
    }

    .longform-prose .footnotes {
      border-top: var(--border-width-hairline) solid var(--color-article-accent);
      margin-top: var(--space-6);
      padding-top: var(--space-4);
      font-size: var(--font-size-sm);

      .data-footnote-backref {
        text-decoration: none;
        color: var(--color-article-accent);
      }
    }

    /* Mobile optimization */
    @media (max-width: 700px) {
      .longform-prose .metadata {
        padding-top: var(--space-10);
      }
    }
  }
</disabled-style>
