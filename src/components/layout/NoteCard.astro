---
import FormattedDate from '@components/ui/FormattedDate.astro';
import Embed from '@components/mdx/Embed.astro';
import Pill from '@components/ui/Pill.astro';

export interface Props {
  title: string;
  pubDate: Date;
  sourceURL?: string;
  tags?: string[];
  slug: string;
}

const { title, pubDate, sourceURL, tags = [], slug } = Astro.props;
---

<article class="note h-entry cq">
  <header class="note-header ui-style">
    <a href={`/notes/${slug}/`} class="date-link">
      <time class="date" datetime={pubDate.toISOString()}>
        <FormattedDate date={pubDate} />
      </time>
    </a>
    <h1 class="p-name title"><a href={`/notes/${slug}/`}>{title}</a></h1>
    {
      tags.length > 0 && (
        <div class="tags">
          {tags.map(tag => (
            <Pill text={tag} />
          ))}
        </div>
      )
    }
  </header>
  {
    sourceURL && (
      <div class="source-url">
        <Embed url={sourceURL} />
      </div>
    )
  }
  <div class="note-content p-content flow">
    <slot />
  </div>
</article>

<style>
  .note {
    width: 100%;
    padding: var(--space-m);
    border-radius: var(--radius-sm);
    border-top: var(--border-width-accent) solid light-dark(var(--color-black), var(--color-accent));

    background-color: var(--surface-raised);
    background-image: radial-gradient(
      light-dark(color-mix(in oklch, var(--color-coral) 20%, transparent), transparent) 0.5px,
      transparent 0
    );
    background-size: var(--space-xs) var(--space-xs);
    color: var(--color-text);
    filter: var(--shadow-medium);

    /* View transition support - uses CSS variable set via inline style */
    view-transition-name: var(--vt-name, none);
    view-transition-class: note-card;
  }

  .note-header {
    display: flex;
    flex-direction: column;
    gap: var(--space-2xs);
    min-width: 0;
  }

  .date-link {
    color: var(--color-text-secondary);
  }

  .date {
    font-size: var(--font-size-xs);
    text-transform: uppercase;
    letter-spacing: var(--tracking-wider);
  }

  h1.title {
    font-size: var(--font-size-lg);
    padding-bottom: var(--space-2xs);
    border-bottom: var(--border-width-base) solid var(--color-accent);
  }

  .tags {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-2xs);
  }

  .source-url,
  .note-content {
    margin-top: var(--space-m);
  }
</style>
