---
import FormattedDate from '@components/ui/FormattedDate.astro';
import Embed from '@components/mdx/Embed.astro';
import Pill from '@components/ui/Pill.astro';

export interface Props {
  title: string;
  pubDate: Date;
  sourceURL?: string;
  tags?: string[];
  slug: string;
}

const { title, pubDate, sourceURL, tags = [], slug } = Astro.props;
---

<article class="note h-entry cq">
  <header class="note-header">
    <a href={`/notes/${slug}/`} class="date-link">
      <time class="date" datetime={pubDate.toISOString()}>
        <FormattedDate date={pubDate} />
      </time>
    </a>
    <h1 class="p-name">{title}</h1>
    {
      tags.length > 0 && (
        <div class="tags">
          {tags.map(tag => (
            <Pill text={tag} />
          ))}
        </div>
      )
    }
  </header>
  {
    sourceURL && (
      <div class="source-url">
        <Embed url={sourceURL} />
      </div>
    )
  }
  <div class="note-content p-content">
    <slot />
  </div>
</article>

<style>
  .note {
    --line-height: calc(1.8 * 1rem);
    width: 100%;
    background: var(--color-notecard-bg);
    padding: var(--line-height);
    background-image: radial-gradient(var(--color-notecard-dot-grid) 0.5px, transparent 0);
    background-size: var(--space-4) var(--space-4);
    filter: var(--elevation-medium);
    border-top: var(--border-width-accent) solid var(--color-notecard-border);
    border-radius: var(--radius-sm);
  }

  .note-header {
    display: flex;
    flex-direction: column;
    gap: var(--space-2);
    min-width: 0; /* Defensive: allow shrinking */
  }

  .date-link {
    text-decoration: none;
  }

  .date {
    font-size: var(--font-size-xs);
    color: var(--color-notecard-date);
    text-transform: uppercase;
    letter-spacing: var(--tracking-wider);
    transition: color var(--duration-normal) var(--ease-default);
  }

  .date-link:hover .date {
    color: var(--color-accent);
  }

  h1 {
    font-size: var(--font-size-lg);
    line-height: var(--leading-snug);
    font-weight: var(--font-weight-semibold);
    margin: 0;
    padding-bottom: var(--space-2);
    border-bottom: var(--border-width-base) solid var(--color-notecard-title-underline);
    overflow-wrap: break-word; /* Defensive: handle long titles */
  }

  .tags {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-2);
    line-height: 1;
  }

  .source-url {
    margin-top: var(--line-height);
  }

  .note-content {
    margin-top: var(--line-height);
  }

  /* Container query styles */
  @container (width > 600px) {
    .note {
      --line-height: calc(2 * 1rem);
      padding: calc(var(--line-height) * 1.5);
    }

    .date {
      font-size: var(--font-size-sm);
    }
  }

  @container (width > 800px) {
    .note {
      --line-height: calc(2.2 * 1rem);
      padding: calc(var(--line-height) * 2);
    }
  }
</style>
