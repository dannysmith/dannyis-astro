# Footnote System Extraction & Styleguide

## Background

The site supports footnotes in markdown content via Astro's built-in remark-gfm. Currently:

1. **Footnote CSS** lives in `src/components/layout/LongFormProseTypography.astro` (lines 203-226) within `@layer longform`
2. **Inline footnote JS + CSS** lives only in `src/layouts/Article.astro`:
   - CSS: lines 171-201 (`.inline-footnote-container`, `.inline-footnote-close`)
   - JS: lines 204-239 (creates toggle behaviour for showing footnotes inline)
3. **Notes don't support footnotes well** - `NoteCard.astro` uses `.flow` not `LongFormProseTypography`

### What Inline Footnotes Do

The inline footnote feature intercepts clicks on footnote references (the superscript numbers) and instead of jumping to the footnotes section at the bottom, it:
- Creates a card below the current paragraph showing the footnote content
- Allows toggling open/closed
- Provides a close button

This is a progressive enhancement - without JS, footnotes work normally with anchor links.

### Footnote HTML Structure (generated by remark-gfm)

**Footnote reference in text:**
```html
<sup><a href="#user-content-fn-1" id="user-content-fnref-1" data-footnote-ref="" aria-describedby="footnote-label">1</a></sup>
```

**Footnotes section at bottom:**
```html
<section data-footnotes="" class="footnotes">
  <h2 class="sr-only" id="footnote-label">Footnotes</h2>
  <ol>
    <li id="user-content-fn-1">
      <p>Footnote content here. <a href="#user-content-fnref-1" data-footnote-backref="" aria-label="Back to reference 1" class="data-footnote-backref">â†©</a></p>
    </li>
  </ol>
</section>
```

## Goal

Make footnotes work consistently across the site and demonstrate them in the styleguide.

---

## Phase 1: Extract InlineFootnotes Component

Create `src/components/layout/InlineFootnotes.astro` containing:
- The CSS currently in Article.astro (lines 171-201)
- The JS currently in Article.astro (lines 204-239)

Update `Article.astro` to import and use `<InlineFootnotes />` instead of having the code inline.

### Acceptance Criteria
- [x] New component created at `src/components/layout/InlineFootnotes.astro`
- [x] Article.astro imports and uses the component
- [ ] Inline footnotes still work on articles (test on `/writing/article-styleguide/`)
- [x] No duplicate code

---

## Phase 2: Add Footnotes to Styleguide

Create `src/pages/styleguide/_snippets/footnotes.mdx` with example footnote markdown.

Update `src/pages/styleguide/_OtherStuff.astro` to:
- Import the footnotes MDX content
- Import `InlineFootnotes` component
- Display footnotes using `SGTypographySwitcher` and `ResizableContainer`
- Include explanatory text about the three footnote elements

### Acceptance Criteria
- [ ] `_snippets/footnotes.mdx` created with realistic footnote content
- [ ] `_OtherStuff.astro` shows footnotes in all three typography contexts
- [ ] Inline footnote behaviour works in the styleguide demo
- [ ] Documentation explains the three elements (ref link, inline popup, section)

---

## Phase 3: Extract Basic Footnote CSS to Global

Currently all footnote CSS is in `LongFormProseTypography.astro` scoped to `.longform-prose`. Some of this should be globally available:

**Should move to global.css:**
- Basic `[data-footnote-ref]` styling (the superscript link)
- Basic `.footnotes` section styling

**Should stay in LongFormProseTypography:**
- Any longform-specific overrides (if any emerge)

This ensures notes and other contexts get reasonable footnote styling by default.

### Acceptance Criteria
- [ ] Basic footnote styles in `global.css` (in appropriate layer)
- [ ] LongFormProseTypography only contains longform-specific overrides (if needed)
- [ ] Footnotes look correct in articles
- [ ] Footnotes look acceptable in notes (if used)
- [ ] Styleguide shows correct styling in all typography tabs

---

## Phase 4: Conditional Inclusion Optimization

Currently, if we include `<InlineFootnotes />` on a page, the JS loads even if there are no footnotes.

Investigate whether we can:
1. Detect at build time if a page has footnotes and conditionally include the component
2. Or make the JS even more lightweight (it already no-ops if no footnotes exist)

This may not be necessary - the JS is small and gracefully handles the no-footnotes case. Evaluate whether the complexity is worth it.

### Acceptance Criteria
- [ ] Evaluate whether optimization is needed
- [ ] If yes: implement conditional inclusion
- [ ] If no: document decision and close phase

---

## Files Involved

- `src/layouts/Article.astro` - current home of inline footnote code
- `src/layouts/Note.astro` - might want inline footnotes in future
- `src/components/layout/LongFormProseTypography.astro` - current footnote CSS
- `src/components/layout/InlineFootnotes.astro` - new component (to create)
- `src/styles/global.css` - destination for base footnote styles
- `src/pages/styleguide/_OtherStuff.astro` - styleguide section to update
- `src/pages/styleguide/_snippets/footnotes.mdx` - new snippet (to create)

## Testing

- `/writing/article-styleguide/` has footnotes - use for testing
- Check both light and dark modes
- Test the inline footnote toggle behaviour
- Verify the back-reference arrows work
